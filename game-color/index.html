<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kekacauan Warna - Brain Gym</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #18181b; 
            touch-action: manipulation;
            user-select: none;
            overflow: hidden;
            height: 100vh; /* Fallback */
            height: 100dvh; /* Mobile Modern */
            -webkit-tap-highlight-color: transparent;
        }
        .timer-bar { transition: width 0.1s linear; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pop-in { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        /* Scrollbar cantik */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }
    </style>
</head>
<body id="main-body" class="w-full flex items-center justify-center text-white relative bg-gradient-to-br from-gray-900 to-black">

    <div id="start-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center p-6 text-center bg-black/80 backdrop-blur-sm">
        <div class="mb-6">
            <h1 class="text-4xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-yellow-500 drop-shadow-lg">KEKACAUAN<br>WARNA</h1>
            <p class="text-gray-300 text-sm mt-2">Brain Gym Edition</p>
        </div>
        
        <div class="bg-gray-800/80 p-4 rounded-xl max-w-xs w-full mb-6 text-left space-y-2 text-sm border border-gray-700">
            <p class="flex items-center gap-2"><span class="text-green-400">‚óº</span> Pilih WARNA Tinta</p>
            <p class="flex items-center gap-2"><span class="text-pink-400">Abc</span> Baca TULISAN Kata</p>
        </div>

        <button id="btn-start-game" class="w-full max-w-xs py-4 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full font-bold text-lg shadow-lg hover:scale-105 active:scale-95 transition-transform mb-4 border border-white/10">
            MULAI GAME
        </button>

        <a href="../index.html" class="mb-4 px-6 py-3 bg-gray-700 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-gray-600 transition flex items-center gap-2">
            üè† Menu Utama
        </a>

        <button id="btn-show-leaderboard" class="text-gray-400 hover:text-white text-xs underline py-2">
            üèÜ Lihat Top 10 Skor
        </button>
    </div>

    <div id="leaderboard-screen" class="hidden absolute inset-0 z-[60] bg-black/95 flex flex-col items-center justify-center p-6">
        <h2 class="text-2xl font-bold text-yellow-400 mb-6">üèÜ Papan Peringkat</h2>
        <div class="bg-gray-800 w-full max-w-md rounded-xl border border-gray-700 overflow-hidden flex flex-col h-[50vh]">
            <div class="grid grid-cols-3 bg-gray-700 p-3 font-bold text-xs uppercase text-gray-300">
                <div class="text-center">#</div>
                <div>Nama</div>
                <div class="text-right">Skor</div>
            </div>
            <div id="leaderboard-list" class="overflow-y-auto custom-scroll p-0 flex-1"></div>
        </div>
        <button id="btn-close-leaderboard" class="mt-6 px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-full font-bold">Tutup</button>
    </div>

    <div id="game-over-screen" class="hidden absolute inset-0 z-50 bg-black/90 flex flex-col items-center justify-center p-6 text-center">
        <h2 class="text-4xl font-bold text-red-500 mb-2">Waktu Habis!</h2>
        
        <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-xs mb-6 border border-gray-700 shadow-2xl mt-4">
            <div class="text-gray-400 text-sm uppercase tracking-widest mb-1">Skor Kamu</div>
            <div id="final-score" class="text-6xl font-bold text-white">0</div>
        </div>

        <div id="new-record-section" class="hidden w-full max-w-xs animate-bounce-in">
            <p class="text-yellow-400 font-bold mb-2">üéâ REKOR BARU! üéâ</p>
            <input type="text" id="player-name-input" maxlength="10" placeholder="NAMA KAMU" 
                class="w-full px-4 py-3 bg-gray-900 border border-yellow-500 rounded-lg text-center text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-3 uppercase font-bold">
            <button id="btn-save-record" class="w-full py-3 bg-yellow-500 text-black font-bold rounded-lg hover:bg-yellow-400">SIMPAN</button>
        </div>

        <div id="standard-buttons" class="w-full max-w-xs flex flex-col gap-3">
            <button id="btn-retry" class="w-full py-3 bg-white text-black font-bold rounded-full shadow-lg hover:bg-gray-200 transition active:scale-95">Main Lagi</button>
            <a href="../index.html" class="w-full py-3 border border-white/20 text-white font-bold rounded-full hover:bg-white/10 transition flex justify-center items-center gap-2">
               üè† Menu Utama
            </a>
            <button id="btn-show-leaderboard-over" class="text-gray-500 hover:text-white text-sm underline mt-2">Lihat Peringkat</button>
        </div>
    </div>

    <div id="game-ui" class="hidden w-full max-w-md h-full flex flex-col p-4 pb-8">
        <div class="flex justify-between items-center mb-4">
            <div class="bg-white/10 px-4 py-2 rounded-full border border-white/10">
                <span class="text-gray-400 text-xs uppercase mr-2">Skor</span>
                <span id="score-display" class="font-bold text-xl">0</span>
            </div>
            <a href="../index.html" class="w-8 h-8 flex items-center justify-center bg-red-500/20 text-red-400 rounded-full font-bold text-xs border border-red-500/50">‚úñ</a>
        </div>
        
        <div class="w-full h-3 bg-gray-800 rounded-full overflow-hidden border border-white/10 mb-4">
            <div id="timer-bar" class="h-full bg-green-500 w-full"></div>
        </div>

        <div class="flex-1 flex flex-col items-center justify-center min-h-0">
            <div id="instruction-container" class="mb-8 transition-all">
                <span id="instruction-text" class="px-6 py-2 bg-black/50 rounded-full font-bold border border-white/20">...</span>
            </div>
            
            <div id="challenge-word-container" class="w-full text-center">
                <h1 id="challenge-word" class="text-6xl font-black tracking-wider drop-shadow-2xl transition-all">...</h1>
            </div>
        </div>

        <div id="buttons-container" class="grid grid-cols-2 gap-3 mt-auto h-1/3 max-h-48">
            </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- KONFIGURASI ---
            const COLORS = {
                merah:  { hex: '#ef4444', label: 'MERAH',  border: 'border-red-600', text: 'text-red-500' },
                biru:   { hex: '#3b82f6', label: 'BIRU',   border: 'border-blue-600', text: 'text-blue-500' },
                hijau:  { hex: '#22c55e', label: 'HIJAU',  border: 'border-green-600', text: 'text-green-500' },
                kuning: { hex: '#eab308', label: 'KUNING', border: 'border-yellow-500', text: 'text-yellow-400' },
                ungu:   { hex: '#a855f7', label: 'UNGU',   border: 'border-purple-600', text: 'text-purple-500' },
                oranye: { hex: '#f97316', label: 'ORANYE', border: 'border-orange-600', text: 'text-orange-500' },
                pink:   { hex: '#ec4899', label: 'PINK',   border: 'border-pink-600', text: 'text-pink-500' },
                cyan:   { hex: '#06b6d4', label: 'CYAN',   border: 'border-cyan-600', text: 'text-cyan-400' }
            };

            const THEMES = [
                "from-gray-900 to-black", "from-blue-900 to-slate-900", "from-red-900 to-orange-950",
                "from-purple-900 to-slate-950", "from-emerald-900 to-gray-900"
            ];

            const STORAGE_KEY = 'colorChaos_v6';
            
            // --- STATE ---
            let score = 0;
            let timerInterval;
            let isGameOver = false;
            let currentRule = 'color';
            let activeKeys = [];
            let currentWordKey = '';
            let currentColorKey = '';
            let maxTime = 3000;

            // --- ELEMEN DOM ---
            const els = {
                start: document.getElementById('start-screen'),
                game: document.getElementById('game-ui'),
                over: document.getElementById('game-over-screen'),
                leaderboard: document.getElementById('leaderboard-screen'),
                score: document.getElementById('score-display'),
                finalScore: document.getElementById('final-score'),
                timer: document.getElementById('timer-bar'),
                instruction: document.getElementById('instruction-text'),
                word: document.getElementById('challenge-word'),
                wordCont: document.getElementById('challenge-word-container'),
                buttons: document.getElementById('buttons-container'),
                body: document.getElementById('main-body')
            };

            // --- EVENT LISTENERS (Dipasang via JS agar aman) ---
            document.getElementById('btn-start-game').onclick = startGame;
            document.getElementById('btn-retry').onclick = startGame;
            document.getElementById('btn-show-leaderboard').onclick = showLeaderboard;
            document.getElementById('btn-show-leaderboard-over').onclick = showLeaderboard;
            document.getElementById('btn-close-leaderboard').onclick = closeLeaderboard;
            document.getElementById('btn-save-record').onclick = saveRecord;

            // --- FUNGSI UTAMA ---
            function startGame() {
                score = 0;
                maxTime = 3000;
                isGameOver = false;
                showScreen('game');
                updateScoreUI();
                randomizeContext();
                nextRound();
            }

            function randomizeContext() {
                // Ganti background
                const theme = THEMES[Math.floor(Math.random() * THEMES.length)];
                els.body.className = `w-full flex items-center justify-center text-white relative bg-gradient-to-br ${theme} h-[100dvh] overflow-hidden`;

                // Acak Tombol (Pilih 4 warna)
                const keys = Object.keys(COLORS).sort(() => 0.5 - Math.random()).slice(0, 4);
                activeKeys = keys;
                renderButtons(keys);
            }

            function renderButtons(keys) {
                els.buttons.innerHTML = '';
                keys.forEach(key => {
                    const data = COLORS[key];
                    const btn = document.createElement('button');
                    btn.className = `w-full h-full bg-black/40 backdrop-blur border-b-4 rounded-xl active:scale-95 transition-all flex items-center justify-center shadow-lg ${data.border}`;
                    btn.innerHTML = `<span class="${data.text} font-bold text-xl md:text-2xl pointer-events-none">${data.label}</span>`;
                    
                    // Event Handler Universal (Touch & Click)
                    const hit = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        handleAnswer(key);
                    };
                    btn.addEventListener('touchstart', hit, {passive: false});
                    btn.addEventListener('click', hit);
                    
                    els.buttons.appendChild(btn);
                });
            }

            function nextRound() {
                if (isGameOver) return;

                // Ganti Tema tiap 50 poin
                if(score > 0 && score % 50 === 0) randomizeContext();

                // Tentukan Soal
                currentRule = Math.random() > 0.5 ? 'color' : 'text';
                currentWordKey = activeKeys[Math.floor(Math.random() * activeKeys.length)];
                
                // Tentukan Warna Tinta (20% kemungkinan sama, 80% beda)
                if (Math.random() > 0.2) {
                    const conflicts = activeKeys.filter(k => k !== currentWordKey);
                    currentColorKey = conflicts[Math.floor(Math.random() * conflicts.length)];
                } else {
                    currentColorKey = currentWordKey;
                }

                renderQuestion();
                startTimer();
            }

            function renderQuestion() {
                const iText = currentRule === 'color' ? "Pilih WARNA TINTA" : "Baca TULISAN KATA";
                const iColor = currentRule === 'color' ? "text-purple-400 border-purple-500" : "text-blue-400 border-blue-500";
                
                els.instruction.innerHTML = iText;
                els.instruction.className = `px-6 py-2 bg-black/60 rounded-full text-base font-bold border-2 shadow-lg transition-all block text-center ${iColor}`;

                els.word.innerText = COLORS[currentWordKey].label;
                els.word.style.color = COLORS[currentColorKey].hex;
                
                // Animasi Pop
                els.wordCont.classList.remove('pop-in');
                void els.wordCont.offsetWidth;
                els.wordCont.classList.add('pop-in');
            }

            function startTimer() {
                clearInterval(timerInterval);
                let timeLimit = Math.max(1200, maxTime - (score * 5)); // Makin lama makin cepat
                let startTime = Date.now();
                let endTime = startTime + timeLimit;

                els.timer.className = "h-full w-full bg-green-500";
                
                timerInterval = setInterval(() => {
                    let left = endTime - Date.now();
                    let pct = (left / timeLimit) * 100;
                    
                    if (left <= 0) {
                        gameOver();
                    } else {
                        els.timer.style.width = pct + "%";
                        if(pct < 30) els.timer.className = "h-full w-full bg-red-500 shadow-[0_0_10px_red]";
                    }
                }, 16);
            }

            function handleAnswer(key) {
                if(isGameOver) return;
                
                const correctKey = currentRule === 'color' ? currentColorKey : currentWordKey;
                
                if (key === correctKey) {
                    score += 10;
                    updateScoreUI();
                    nextRound();
                } else {
                    gameOver();
                }
            }

            function gameOver() {
                isGameOver = true;
                clearInterval(timerInterval);
                els.finalScore.innerText = score;
                showScreen('over');

                // Cek High Score
                const scores = getScores();
                const minScore = scores.length < 10 ? 0 : scores[scores.length-1].score;
                
                const recSec = document.getElementById('new-record-section');
                const stdBtn = document.getElementById('standard-buttons');

                if (score > 0 && (scores.length < 10 || score > minScore)) {
                    recSec.classList.remove('hidden');
                    stdBtn.classList.add('hidden');
                    document.getElementById('player-name-input').value = "";
                } else {
                    recSec.classList.add('hidden');
                    stdBtn.classList.remove('hidden');
                }
            }

            function saveRecord() {
                const name = document.getElementById('player-name-input').value.toUpperCase().substring(0,10) || "PLAYER";
                let scores = getScores();
                scores.push({name, score});
                scores.sort((a,b) => b.score - a.score);
                scores = scores.slice(0, 10);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
                
                document.getElementById('new-record-section').classList.add('hidden');
                document.getElementById('standard-buttons').classList.remove('hidden');
                showLeaderboard();
            }

            function getScores() {
                return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
            }

            function showLeaderboard() {
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = "";
                const scores = getScores();
                
                if(scores.length === 0) {
                    list.innerHTML = '<div class="text-center text-gray-500 p-4">Belum ada data</div>';
                } else {
                    scores.forEach((s, i) => {
                        const row = document.createElement('div');
                        row.className = "flex justify-between p-3 border-b border-gray-700 text-sm";
                        row.innerHTML = `<span class="w-8">${i+1}.</span><span class="flex-1 font-bold">${s.name}</span><span class="text-yellow-400">${s.score}</span>`;
                        list.appendChild(row);
                    });
                }
                showScreen('leaderboard');
            }

            function closeLeaderboard() {
                if(isGameOver) showScreen('over');
                else showScreen('start');
            }

            function showScreen(id) {
                ['start','game','over','leaderboard'].forEach(k => els[k].classList.add('hidden'));
                els[id].classList.remove('hidden');
                if(id === 'game') els[id].classList.add('flex');
            }

            function updateScoreUI() {
                els.score.innerText = score;
            }
        });
    </script>
</body>
</html>
